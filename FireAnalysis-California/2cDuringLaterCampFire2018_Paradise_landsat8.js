/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var paradise = /* color: #d63000 */ee.Geometry.Polygon(
        [[[-122.30675844884837, 40.19310857323741],
          [-122.31292020027229, 40.18989858697351],
          [-122.31299431691531, 40.17078158713574],
          [-122.32283528390752, 40.17091660807705],
          [-122.32309446887626, 40.163042608612145],
          [-122.35106142161317, 40.163564661403214],
          [-122.35107745265503, 40.15628566143063],
          [-122.36097044806604, 40.15648467775406],
          [-122.3609864774628, 40.1492386777795],
          [-122.38067640832014, 40.14917570661105],
          [-122.3806844302917, 40.141713706621815],
          [-122.45232983084964, 40.14171777048681],
          [-122.45657840450383, 40.14172077225194],
          [-122.45631224812064, 40.134493772148026],
          [-122.46597309879576, 40.134659775351295],
          [-122.46571795610134, 40.109427775281745],
          [-122.46576398399611, 40.10933277529435],
          [-122.46579900796365, 40.103385775303956],
          [-122.46582402518993, 40.098896775310756],
          [-122.4687367880336, 40.09628477605234],
          [-122.47536479662489, 40.09628377734322],
          [-122.4788308929052, 40.09628277779887],
          [-122.47892094891631, 40.087947777808694],
          [-122.48747612151953, 40.08830977827875],
          [-122.48799943786037, 40.08061477827771],
          [-122.49628244462264, 40.08069477780381],
          [-122.49628244203757, 40.06682777780381],
          [-122.50637554000673, 40.06700877606322],
          [-122.50564108507098, 40.038020776232976],
          [-122.51605637134696, 40.038256773193226],
          [-122.516249478965, 40.02368377312403],
          [-122.53757034140114, 40.02442776260649],
          [-122.57355305039493, 40.025596731925624],
          [-122.5744155635989, 40.02175273099089],
          [-122.57783762085342, 40.01815972719041],
          [-122.58524507709467, 40.012712718460705],
          [-122.59155488001358, 40.011841710481825],
          [-122.59533215086418, 40.008888705466404],
          [-122.5963717681015, 40.004769704054624],
          [-122.60002695366109, 39.9973086989833],
          [-122.60624269330458, 39.99476668997461],
          [-122.61500994488597, 39.98309267644416],
          [-122.61670295556166, 39.97977367372029],
          [-122.61978477552435, 39.96693566866966],
          [-122.62086739553803, 39.95576966686713],
          [-122.62012994676627, 39.95400766809653],
          [-122.62021799599563, 39.95268066795008],
          [-122.62063123471574, 39.94917966726156],
          [-122.62136066868038, 39.94746266604095],
          [-122.62343190906097, 39.94549366253865],
          [-122.63717115209045, 39.938565637944464],
          [-122.64738926735328, 39.92971761811816],
          [-122.67205709770582, 39.929519564858296],
          [-122.6764077130033, 39.929415554673255],
          [-122.67434345649906, 39.92554255953538],
          [-122.68224320524132, 39.92550754063922],
          [-122.74405636200402, 39.92519236575922],
          [-122.74049817394337, 39.91608037712576],
          [-122.727190003712, 39.88221541823077],
          [-122.72458640781451, 39.875640426012716],
          [-122.72078410759025, 39.87190443722481],
          [-122.71162857115979, 39.86286246347832],
          [-122.7181804743177, 39.85741444479761],
          [-122.71939918395049, 39.85311144126343],
          [-122.71927705478384, 39.84175844161836],
          [-122.7181923959318, 39.83997344476302],
          [-122.7149864614891, 39.83727245397147],
          [-122.71460422870985, 39.83650145506075],
          [-122.71446710507303, 39.82790345545102],
          [-122.71401478588064, 39.817881456736835],
          [-122.71111305910063, 39.82018146492503],
          [-122.70851149961646, 39.81988147217639],
          [-122.70668039694579, 39.81858547722935],
          [-122.7049323485594, 39.818252482013875],
          [-122.69990633610553, 39.817681495556954],
          [-122.69859955500834, 39.8180084990263],
          [-122.69260195535674, 39.816181514674454],
          [-122.6871987278733, 39.81808152838558],
          [-122.68549770752333, 39.81768153262627],
          [-122.67705061512095, 39.80926655314748],
          [-122.67626814359647, 39.808497555003086],
          [-122.67268898709659, 39.80498156339317],
          [-122.66488430972947, 39.80348158113136],
          [-122.66278305053743, 39.80308158577649],
          [-122.6630311980573, 39.8028115852308],
          [-122.6623828094925, 39.802681586655],
          [-122.66204260561801, 39.802613587400145],
          [-122.66188250967747, 39.80258158775031],
          [-122.65998138168425, 39.80528159188385],
          [-122.65394377227369, 39.80658860471053],
          [-122.65727975659996, 39.80308159767986],
          [-122.66058171568449, 39.79838159058343],
          [-122.6646001000525, 39.79295658176284],
          [-122.66468415005971, 39.79288158157619],
          [-122.66468414893097, 39.79258158157619],
          [-122.66248283407674, 39.793181586435594],
          [-122.66068176857618, 39.79648159036626],
          [-122.65548567495148, 39.80088860147827],
          [-122.64857448940847, 39.786481615733216],
          [-122.66138213970981, 39.783481588842555],
          [-122.670087339129, 39.7815815693909],
          [-122.6708598005099, 39.78142356761892],
          [-122.67039751893424, 39.78011056868026],
          [-122.66958703488382, 39.78028157053454],
          [-122.66658524154622, 39.780781577330565],
          [-122.65788003128239, 39.779681596399854],
          [-122.65776096009074, 39.77968659665411],
          [-122.65620102947969, 39.78032759996849],
          [-122.6434573931557, 39.77582062590171],
          [-122.63600393968841, 39.7769026401254],
          [-122.63571276453916, 39.77657464066691],
          [-122.62478123094974, 39.7776806602277],
          [-122.61910884348436, 39.77933866978716],
          [-122.61805921796065, 39.7801296715118],
          [-122.59970416566432, 39.74860069943748],
          [-122.59930892789697, 39.747900699992314],
          [-122.60169034730558, 39.746586696619545],
          [-122.60471515251925, 39.74593069223298],
          [-122.63881150927256, 39.742830634849305],
          [-122.64264379815052, 39.74283062748808],
          [-122.64644607133732, 39.743494620002494],
          [-122.64843124847158, 39.74098361602216],
          [-122.64831117044787, 39.73913161626431],
          [-122.648308156062, 39.73543761627038],
          [-122.6302333152455, 39.71947865065898],
          [-122.61410065481584, 39.70716867789167],
          [-122.60858735531372, 39.702960686449984],
          [-122.58609489933912, 39.68326471741476],
          [-122.56284200793169, 39.66275474275569],
          [-122.56195447704283, 39.66128974358854],
          [-122.55727668885459, 39.65966474781498],
          [-122.54881064081576, 39.65465275476628],
          [-122.54369058659859, 39.649800758534035],
          [-122.53350951898398, 39.64270476504913],
          [-122.50117126894702, 39.62832277712023],
          [-122.49099421486278, 39.62323077820569],
          [-122.48928219683489, 39.62779877826062],
          [-122.48961739680004, 39.64123077825276],
          [-122.488878957402, 39.64329077826823],
          [-122.4637629978622, 39.66636677472172],
          [-122.45251429042753, 39.67608377056809],
          [-122.42977272147948, 39.691118757323075],
          [-122.42743132392434, 39.692445755591095],
          [-122.41884219889789, 39.69535074864885],
          [-122.41167392380851, 39.695944742146665],
          [-122.40802974804768, 39.69763673859402],
          [-122.4063997722701, 39.699855736951044],
          [-122.40518404111754, 39.70337973570394],
          [-122.40118464853037, 39.707337731470545],
          [-122.40639875655796, 39.70864273695004],
          [-122.42249034657812, 39.715339751710566],
          [-122.42840585993565, 39.728351756320365],
          [-122.42761238072598, 39.73270875572751],
          [-122.42782850875687, 39.73350475588978],
          [-122.43147368423416, 39.734287758538194],
          [-122.43259535284585, 39.73524575931963],
          [-122.43251028958503, 39.74592675926094],
          [-122.43148267336937, 39.74793675854453],
          [-122.42669580864447, 39.75195575503287],
          [-122.42611745947062, 39.75474475458914],
          [-122.42695095766351, 39.754616755227296],
          [-122.43151668658925, 39.753907758568445],
          [-122.42997375711559, 39.76010875746861],
          [-122.42982566485512, 39.76317475736147],
          [-122.43464153287891, 39.772429760704476],
          [-122.43519185933178, 39.77475276106797],
          [-122.43548103133162, 39.775573761257476],
          [-122.43552605351829, 39.77985976128687],
          [-122.43559208617529, 39.786052761329955],
          [-122.43561909953473, 39.78859076134757],
          [-122.43562510256459, 39.78909976135148],
          [-122.43705495714818, 39.789863762270386],
          [-122.43759527910817, 39.791082762610955],
          [-122.43598531033314, 39.796150761585395],
          [-122.43341476490485, 39.802434759880526],
          [-122.43436432872, 39.80643876051997],
          [-122.43341475989996, 39.806782759880534],
          [-122.43350380631858, 39.81277775994098],
          [-122.43198988364804, 39.826503758899804],
          [-122.43522581402345, 39.833759761090306],
          [-122.43659062722134, 39.837993761974815],
          [-122.44074611323043, 39.842317764524026],
          [-122.44101427180567, 39.84449176468108],
          [-122.43979654054607, 39.84579576396059],
          [-122.43944132496512, 39.8483817637469],
          [-122.44067005830806, 39.85167776447931],
          [-122.44172668978558, 39.85378176509397],
          [-122.44042090391929, 39.85666476433233],
          [-122.44137147069438, 39.859982764888905],
          [-122.44163862797075, 39.863002765043305],
          [-122.43961941536782, 39.86442176385426],
          [-122.43863682356726, 39.86672376325714],
          [-122.43733403671342, 39.87169876244676],
          [-122.43412711237522, 39.87185876036131],
          [-122.43166163078962, 39.8737807586703],
          [-122.42940427038013, 39.87853975705517],
          [-122.42964141010259, 39.88064475722785],
          [-122.42922615874102, 39.88236075692502],
          [-122.42298941442851, 39.882977752116524],
          [-122.42180070024074, 39.88345875114467],
          [-122.4171669141445, 39.88656974718708],
          [-122.41505764434629, 39.88888074529642],
          [-122.4135417301681, 39.891465743903154],
          [-122.40718190431085, 39.89572073774375],
          [-122.40664657968824, 39.89755073720215],
          [-122.40911105598224, 39.89979373966569],
          [-122.40388191039312, 39.90258373434785],
          [-122.39805840958769, 39.90409172802191],
          [-122.39452429117085, 39.90182572397548],
          [-122.38834658537922, 39.89955771652598],
          [-122.38160152929083, 39.90179770784573],
          [-122.38136037320919, 39.906762707524834],
          [-122.3818016287529, 39.91099570811146],
          [-122.37867873292151, 39.91939170390719],
          [-122.37731090766772, 39.920740702027196],
          [-122.37615221189367, 39.92046570041628],
          [-122.37120123435477, 39.921196693343305],
          [-122.37074996168906, 39.92176969268334],
          [-122.36742193331139, 39.932707687737306],
          [-122.36439509837237, 39.93838368311828],
          [-122.359763293561, 39.94541067582756],
          [-122.35370163613447, 39.94923466587965],
          [-122.35040165049037, 39.94930466027025],
          [-122.34469620607547, 39.95315065024977],
          [-122.33128912728051, 39.95653962509599],
          [-122.3283163393258, 39.956219619213215],
          [-122.31841537126382, 39.95889859882106],
          [-122.31276596055073, 39.96173558663455],
          [-122.30378755764866, 39.96139256644334],
          [-122.3028950243023, 39.960408564380906],
          [-122.3028059742245, 39.95951556417458],
          [-122.30209254619183, 39.95917256251803],
          [-122.3008738119538, 39.959355559673426],
          [-122.29981316875018, 39.96056355718266],
          [-122.29772292907921, 39.95601455223268],
          [-122.2835443954832, 39.95625451720961],
          [-122.28106690437869, 39.95628951083105],
          [-122.28115189235314, 39.97063151105124],
          [-122.2906446072405, 39.97080453506342],
          [-122.28994906614741, 39.999788533342546],
          [-122.28046034782437, 39.999609509257944],
          [-122.28034615121476, 40.02846450896137],
          [-122.28988790694774, 40.02874753319108],
          [-122.28945356566652, 40.047446532113035],
          [-122.28955058391887, 40.05696453235413],
          [-122.27962659049064, 40.05692650708803],
          [-122.27966558144158, 40.06425350718976],
          [-122.27970657252956, 40.071822507296694],
          [-122.27039694749294, 40.071721482481216],
          [-122.27041185619248, 40.09329348252196],
          [-122.2523139132295, 40.09302543117337],
          [-122.25204372378693, 40.09818943037569],
          [-122.2471207457109, 40.09828741568053],
          [-122.24688852966545, 40.112945414979976],
          [-122.23718065421588, 40.11308638508285],
          [-122.23704654199435, 40.1188713846616],
          [-122.23685638184878, 40.1272523840639],
          [-122.24210055694863, 40.12725340038242],
          [-122.24211356475593, 40.12726640042245],
          [-122.24683542360458, 40.127270414819755],
          [-122.2464800917395, 40.14984441374622],
          [-122.2506256035839, 40.14986042617416],
          [-122.25606489935706, 40.149882442153775],
          [-122.25590576691297, 40.157128441691604],
          [-122.27486325863202, 40.15676349452266],
          [-122.27456991582562, 40.19284549373972],
          [-122.30675844884837, 40.19310857323741]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
//Paradise City Shapefile was made an import to save on printed lines

//L7SR Bands and Human-Friendly Naming
var LANDSAT_7_BANDS = ["B1", "B2", "B3","B4","B5","B6","B7"];
var STD_NAMES = ["blue","green","red","nir","swir1","tir","swir2"];

//Add an outline of the city of Paradise
Map.addLayer(paradise, {color: "000000"}, "City of Paradise", 1, 1);

//Center Map
Map.setCenter(-122.505, 39.905, 10);

//filtering Against Paradise at 1-year resolution
var landsat_SR = ee.ImageCollection("LANDSAT/LE07/C01/T1_SR") //load LANDSAT7 raws for during the fire period
	.filterBounds(paradise)
	.filterDate("2018-11-08","2018-11-25")
	// No need to filter for cloudy scenes: smoke is a given in fires.
	.select(LANDSAT_7_BANDS, STD_NAMES);

print(landsat_SR); //date debug

/*
Black Image background
Map.addLayer(ee.Image(0), {color: "000000"}, "Black Background", 1, 1);
*/

var single = landsat_SR.median();

//Display the Composite
Map.addLayer(landsat_SR, {'bands':["red","blue","green"],min:0,max:2000}, "baselayer", 1, 0);
//Map.addLayer(landsat_SR, {'bands':["tir"],min:0,max:2000}, "temperature", 1, 1);

var inputimage = landsat_SR.median();

function addNDVI(image) {
  return image
    .addBands(image.normalizedDifference(['nir','red']).rename('ndvi'))
  ;
}

var ndvi = addNDVI(inputimage);

//Toggle-display the single median-reduced image.
Map.addLayer(single, {"bands":["red","blue","green"],min:0,max:2000}, "median_image", 1, 0.8);

//Map of NDVI vegetation-water probability.
Map.addLayer(ndvi,{bands:["ndvi"],min:0,max:1}, "ndvilayer", 1, 0.15);

//Landsat True-Color Image Export
//Export Image
var vis = {
  min: 100, 
  max: 2000,
  gamma: 1.5,
  bands: ["red", "green", "blue"]
};

// visualize image using visOpts above
// turning it into 8-bit RGB image.
single = single.visualize(vis);

// obtain native scale of RGB bands
var scale = single.projection().nominalScale().getInfo();

// add an alpha channel as 4th band to mask no data regions
var mask = single.mask().reduce(ee.Reducer.min())
    .multiply(255).toByte();
single = single.addBands(mask);

//Landsat True-Color Image Export
Export.image.toDrive({
  image: single,
  description: "landsat7_duringLaterFire_paradise",
  folder: "California-Paradise_CampFire2018",
  region:paradise,
  scale:30.0,
  fileFormat: "GeoTIFF",
  crs: "EPSG:3857",
  formatOptions: {cloudOptimized: true}
});